<!-- Copyright 2021 Crystal Ferrai
    
     Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at
    
        http://www.apache.org/licenses/LICENSE-2.0
    
     Unless required by applicable law or agreed to in writing, software
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License. -->
    
<Window
    x:Class="SwptSaveEditor.MainWindow"
    x:ClassModifier="internal"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:SwptSaveEditor"
    xmlns:conv="clr-namespace:SwptSaveEditor.Converters"
    xmlns:doc="clr-namespace:SwptSaveEditor.Document"
    Title="{Binding WindowTitle}"
    WindowStartupLocation="Manual"
    Left="{Binding WindowLeft, Mode=TwoWay}"
    Top="{Binding WindowTop, Mode=TwoWay}"
    Width="{Binding WindowWidth, Mode=TwoWay}"
    Height="{Binding WindowHeight, Mode=TwoWay}"
    WindowState="{Binding WindowState, Mode=TwoWay}"
    MinWidth="500"
    MinHeight="400">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        
        <!-- Toolbar -->
        <Border
            Background="#fff8f8f8"
            Padding="4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="24" />
                    <ColumnDefinition Width="10" />
                    <ColumnDefinition Width="4" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="4" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="4" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="4" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <!-- Open -->
                <Button
                    BorderThickness="1 1 0 1"
                    Margin="0 0 -1 0"
                    ToolTip="Open Save Game Folder"
                    ToolTipService.ShowOnDisabled="True"
                    Command="{Binding OpenCommand}">
                    <Image
                        Stretch="None"
                        Source="{x:Static local:Images+ToolbarIcons.OpenFolder}" />
                </Button>
                <ComboBox
                    Grid.Column="1"
                    IsEditable="False"
                    ToolTip="Recently Opened Save Games"
                    ToolTipService.ShowOnDisabled="True"
                    Template="{StaticResource DropDownControl}"
                    ItemsSource="{Binding RecentSaveGames}"
                    SelectedIndex="{Binding RecentSaveIndex}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate
                            DataType="{x:Type local:SaveGameInfo}">
                            <TextBlock
                                Text="{Binding Name}"
                                ToolTip="{Binding Path}" />
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>

                <!-- Close -->
                <Button
                    Grid.Column="3"
                    ToolTip="Close All"
                    ToolTipService.ShowOnDisabled="True"
                    Command="{Binding CloseCommand}">
                    <Image
                        Stretch="None"
                        Source="{x:Static local:Images+ToolbarIcons.Close}"
                        Style="{StaticResource ButtonContentStyle}" />
                </Button>

                <!-- Reload All -->
                <Button
                    Grid.Column="5"
                    ToolTip="Reload All from Disk"
                    ToolTipService.ShowOnDisabled="True"
                    Command="{Binding ReloadCommand}">
                    <Image
                        Stretch="None"
                        Source="{x:Static local:Images+ToolbarIcons.Refresh}"
                        Style="{StaticResource ButtonContentStyle}" />
                </Button>
                
                <!-- Save All -->
                <Button
                    Grid.Column="7"
                    ToolTip="Save All Changed Files"
                    ToolTipService.ShowOnDisabled="True"
                    Command="{Binding SaveAllCommand}">
                    <Image
                        Stretch="None"
                        Source="{x:Static local:Images+ToolbarIcons.SaveAll}"
                        Style="{StaticResource ButtonContentStyle}" />
                </Button>

                <!-- Save All As -->
                <Button
                    Grid.Column="9"
                    ToolTip="Save All Files to a New Location"
                    ToolTipService.ShowOnDisabled="True"
                    Command="{Binding SaveAllAsCommand}">
                    <Image
                        Stretch="None"
                        Source="{x:Static local:Images+ToolbarIcons.AddFolder}"
                        Style="{StaticResource ButtonContentStyle}" />
                </Button>

            </Grid>
        </Border>

        <!-- Container for loaded documents. For individual documents, see SaveDocumentView.xaml -->
        <TabControl
            Grid.Row="1"
            PreviewMouseDown="TabControl_PreviewMouseDown"
            PreviewKeyDown="TabControl_PreviewKeyDown"
            ItemsSource="{Binding Documents}"
            SelectedItem="{Binding DocumentService.ActiveDocument}"
            Visibility="{Binding IsSaveOpen, Converter={x:Static conv:BoolToVisibilityConverter.CollapseInstance}}">
            <TabControl.ItemContainerStyle>
                <Style
                    TargetType="{x:Type TabItem}">
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding UndoService.IsSavePoint}" Value="False">
                            <Setter Property="Foreground" Value="#ffff4000" />
                            <Setter Property="FontWeight" Value="Bold" />
                            <Setter Property="ToolTip" Value="Unsaved Changes" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </TabControl.ItemContainerStyle>
            <TabControl.ItemTemplate>
                <DataTemplate
                    DataType="{x:Type doc:SaveDocument}">
                    <TextBlock
                        Text="{Binding Name}" />
                </DataTemplate>
            </TabControl.ItemTemplate>
        </TabControl>

        <!-- Content shown when nothing is loaded -->
        <Border
            Grid.Row="1"
            Background="#fff8f8f8"
            Visibility="{Binding IsSaveOpen, Converter={x:Static conv:BoolToVisibilityConverter.InvertedInstance}}">
            <Grid
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Margin="50 0"
                MaxWidth="800"
                TextElement.FontSize="12pt">
                <Grid.Resources>
                    <Style
                        TargetType="{x:Type TextBlock}">
                        <Setter Property="TextAlignment" Value="Center" />
                        <Setter Property="TextWrapping" Value="Wrap" />
                    </Style>
                </Grid.Resources>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="20" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="20" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <TextBlock>
                    <Run FontSize="16pt" FontWeight="Bold" Foreground="#ffc02000" Text="Warning" />
                    <LineBreak />
                    <Run Text="Be sure to backup your game saves before editing them with this tool. Your save can easily be destroyed due to a bad edit or due to a bug in the tool." />
                </TextBlock>
                <TextBlock
                    Grid.Row="2">
                    <Run Text="Nothing is open. Use the toolbar above or " /><Hyperlink Command="{Binding OpenCommand}"><Run Text="click here" /></Hyperlink><Run Text=" to open something." />
                </TextBlock>
                <StackPanel
                    Grid.Row="4"
                    Visibility="{Binding HasRecentSave, Converter={x:Static conv:BoolToVisibilityConverter.HideInstance}}">
                    <TextBlock Text="Recently edited:" />
                    <ItemsControl
                        HorizontalAlignment="Center"
                        ItemsSource="{Binding RecentSaveGames}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" IsItemsHost="True" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate
                                DataType="{x:Type local:SaveGameInfo}">
                                <TextBlock
                                    Margin="5 0"
                                    TextAlignment="Center">
                                    <Hyperlink
                                        Command="{Binding DataContext.OpenRecentCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                                        CommandParameter="{Binding Path}">
                                        <Run Text="{Binding Name, Mode=OneWay}" />
                                    </Hyperlink>
                                </TextBlock>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Grid>
        </Border>
        
    </Grid>
</Window>
